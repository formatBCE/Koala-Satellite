packages:
  remote_package:
    url: https://github.com/Pimmeke1989/Voice-Satellite
    ref: main
    files:
      - config/common/voice-base.yaml
    refresh: 0s

esphome:
  friendly_name: LumiTone S1
  name_add_mac_suffix: false

wifi:
  ap:
    ssid: "LumiTone S1"
  ssid: !secret wifi_ssid
  password: !secret wifi_password

api:
  encryption:
    key: !secret api_key

globals:
  - id: current_version
    type: std::string
    # Keep this in sync with your firmware project.version (voice-base.yaml)
    initial_value: "2025.12.6"

text_sensor:
  - platform: http_request
    id: github_latest_tag
    name: "GitHub Latest Release Tag"
    resource: "https://api.github.com/repos/Pimmeke1989/Voice-Satellite/releases/latest"
    headers:
      Accept: application/vnd.github.v3+json
      User-Agent: esphome-device
    value_template: "{{ value_json.tag_name }}"
    scan_interval: 3600s

binary_sensor:
  - platform: template
    name: "Voice-Satellite Update Available"
    id: update_available
    lambda: |-
      if (!id(github_latest_tag).has_state()) return false;
      if (id(github_latest_tag).state == id(current_version)) return false;
      return true;
    on_state:
      then:
        - homeassistant.event:
            event: esphome_update_available
            data:
              device: "LumiTone S1"
              current_version: !lambda 'return id(current_version);'
              latest_version: !lambda 'return id(github_latest_tag).state;'